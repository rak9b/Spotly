openapi: 3.0.0
info:
  title: LocalGuide.ai API
  version: 1.0.0
  description: Comprehensive API for LocalGuide.ai platform including Events, Bookings, AI, and Wallet.
servers:
  - url: /api/v1
    description: Production API
paths:
  /auth/register:
    post:
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, role]
              properties:
                email: { type: string, format: email }
                password: { type: string, minLength: 8 }
                role: { type: string, enum: [tourist, guide, host] }
                firstName: { type: string }
                lastName: { type: string }
      responses:
        '201':
          description: User created
  /auth/login:
    post:
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token: { type: string }
                  refresh_token: { type: string }
  /events:
    get:
      summary: List events
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: city
          schema: { type: string }
        - in: query
          name: start_date
          schema: { type: string, format: date }
      responses:
        '200':
          description: List of events
    post:
      summary: Create event
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventInput'
      responses:
        '201':
          description: Event created
  /bookings:
    post:
      summary: Create booking
      security: [{ bearerAuth: [] }]
      parameters:
        - in: header
          name: Idempotency-Key
          schema: { type: string }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [event_id, seats]
              properties:
                event_id: { type: string, format: uuid }
                seats: { type: integer, minimum: 1 }
      responses:
        '201':
          description: Booking created
  /ai/planner:
    post:
      summary: Generate itinerary
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                destination: { type: string }
                dates: 
                  type: object
                  properties: { from: { type: string }, to: { type: string } }
                interests: { type: array, items: { type: string } }
      responses:
        '200':
          description: AI generated itinerary
  /wallet:
    get:
      summary: Get wallet balance
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Wallet details
          content:
            application/json:
              schema:
                type: object
                properties:
                  balance_cents: { type: integer }
                  currency: { type: string }
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    EventInput:
      type: object
      required: [title, city, price_cents, start_time]
      properties:
        title: { type: string }
        description: { type: string }
        city: { type: string }
        price_cents: { type: integer }
        start_time: { type: string, format: date-time }
        max_participants: { type: integer }
        images: { type: array, items: { type: string } }
